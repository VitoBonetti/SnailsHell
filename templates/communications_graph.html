<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Communication Graph</title>
    <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet" type="text/css" />
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrollbars */
            font-family: sans-serif;
        }
        #network {
            width: 100%;
            height: 100%;
            border: 1px solid lightgray;
            background-color: #f8f9fa;
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2em;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div id="network"></div>
    <div id="loading" class="loading">Loading graph...</div>

    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('network');
            const loadingDiv = document.getElementById('loading');
            const hostId = '{{ .HostID }}'; // Get the host ID from the Go template

            // Fetch data from our new API endpoint
            fetch(`/api/hosts/${hostId}/communications`)
                .then(response => response.json())
                .then(data => {
                    loadingDiv.style.display = 'none'; // Hide loading message

                    const nodes = new vis.DataSet(data.nodes);
                    const edges = new vis.DataSet(data.edges);

                    const networkData = {
                        nodes: nodes,
                        edges: edges,
                    };

                    const options = {
                        nodes: {
                            borderWidth: 2,
                            font: {
                                size: 14,
                                color: '#343434'
                            }
                        },
                        edges: {
                            width: 2,
                            font: {
                                align: 'top'
                            },
                            color: {
                                color: '#848484',
                                highlight: '#848484',
                                hover: '#848484'
                            }
                        },
                        physics: {
                            solver: 'forceAtlas2Based',
                            forceAtlas2Based: {
                                gravitationalConstant: -50,
                                centralGravity: 0.01,
                                springLength: 200,
                                springConstant: 0.08,
                                avoidOverlap: 0.5
                            }
                        },
                        interaction: {
                            hover: true,
                            tooltipDelay: 300,
                            navigationButtons: true,
                            keyboard: true
                        }
                    };

                    const network = new vis.Network(container, networkData, options);
                })
                .catch(error => {
                    console.error('Error fetching or rendering graph:', error);
                    loadingDiv.innerText = 'Failed to load graph data.';
                });
        });
    </script>
</body>
</html>